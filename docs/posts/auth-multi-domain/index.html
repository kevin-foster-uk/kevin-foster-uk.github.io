<!DOCTYPE html>
<html lang="en-GB" class="scroll-smooth dark">
  <head>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simplifying SaaS Authentication Across Multiple Domains</title>
<meta
  name="description"
  content="A clean, user-friendly single-sign-on experience across multiple customer domains, simplifying a traditionally complex part of SaaS architecture."
/>
<link rel="canonical" href="https://www.kevfoster.co.uk/posts/auth-multi-domain/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="https://www.kevfoster.co.uk/css/app.min.b4160cf32a436fd8d53214a1bd9633d10bd7a5d9ae4d1637c20d48acf07716fd.css" /><style>


 
.mermaid text,
.mermaid tspan,
.mermaid .label,
.mermaid .nodeLabel,
.mermaid .edgeLabel,
.mermaid .clusterLabel,
.mermaid .label text,
.mermaid [class*="Label"] {
  font-size: 18px !important;
  font-family: Arial, sans-serif !important;
}

 
.mermaid .flowchart-label text,
.mermaid .sequence-diagram text,
.mermaid .classDiagram-label text,
.mermaid .stateDiagram-label text {
  font-size: 18px !important;
}

.mermaid .label {
  text-align: center !important;
  dominant-baseline: middle !important;
  text-anchor: middle !important;
}
</style></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="https://www.kevfoster.co.uk/">
    <img
      srcset="/img/profile-picture_hu10090986920638988592.jpg 80w"
      src="/img/profile-picture.jpg"
      width="272"
      height="296"
      alt="Kevin Foster"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="https://www.kevfoster.co.uk/">
  <h1 id="site-title">Kevin Foster</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
    <li>
      <a href="/recommendations" class="">
        Recommendations
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>

    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Simplifying SaaS Authentication Across Multiple Domains</h2>

    <div class="meta">
      
      <time datetime="2025-10-04 09:00:00 &#43;0000 UTC" title='Sat, Oct 4, 2025, 9:00 AM UTC'>
        04/10/2025
      </time>

      
       —
        
          <a class="categories" href="/categories/authentication/" alt="Authentication">
            Authentication
          </a>
        
          <a class="categories" href="/categories/saas/" alt="SaaS">
            SaaS
          </a>
        
      
    </div>
  </header>

  

  <section><p>When building a SaaS application, it is common to give each customer their own subdomain or custom domain. At the same time, you often need a central system for user authentication and management. This is crucial for billing, as it maps which users are subscribed to which services.</p>
<p>Users may also need access to multiple application instances. A single-sign-on (SSO) system is essential here. It prevents the awkwardness of users managing separate logins for each instance and having to log in and out repeatedly.</p>
<p>However, combining custom domains with centralised authentication introduces complexity. The browser treats each domain as separate, with its own session storage, local storage, and cookies. For security reasons, one domain cannot access data stored by another. This makes sharing authentication states tricky.</p>
<p>A typical solution involves redirecting users to a central auth system and back again, which requires backend services to communicate. While it works, this process can be clunky.</p>
<h3 id="a-client-side-approach-with-jwt-and-popups">A Client-Side Approach with JWT and Popups</h3>
<p>What if we could handle the logistics of multi-domain authentication entirely on the client side, without further server communication? We can achieve this using JSON Web Tokens (JWT) and the browser&rsquo;s postMessage API.</p>
<p>Here is how the process works:</p>
<ol>
<li>A user visits a protected page on <code>app.domain.com</code>.</li>
<li>They are redirected to your auth domain, <code>auth.domain.com</code>, with the original URL as a query parameter.</li>
<li>The user logs in. The auth server returns a JWT containing basic user information, including a list of domains they can access.</li>
<li>The system confirms that <code>app.domain.com</code> is on the user&rsquo;s permitted list.</li>
<li>A child window (popup) is opened to the target domain, <code>app.domain.com</code>. Using <code>postMessage</code>, the JWT is sent to this new window.</li>
<li>The target domain receives the JWT and uses it to initialise its own local authentication session.</li>
<li>The popup sends a message back to the parent window to confirm success.</li>
<li>The parent window closes the popup and redirects the user to <code>app.domain.com</code>.</li>
</ol>
<p>The user is now authenticated on both the auth domain and the application domain, with all the complexity handled seamlessly by the client.</p>
<pre class="mermaid">
  sequenceDiagram
  participant U as User
  participant A as App&lt;br/&gt; (app.domain.com)
  participant Auth as Auth Server&lt;br/&gt;  (auth.domain.com)
  participant P as Popup Window&lt;br/&gt;  (app.domain.com)

  Note over U, P: Step 1: Initial Request
  U-&gt;&gt;A: Visits protected page
  A-&gt;&gt;U: 302 Redirect to auth.domain.com?returnTo=&lt;url&gt;

  Note over U, P: Step 2-3: Authentication
  U-&gt;&gt;Auth: Lands on login page
  U-&gt;&gt;Auth: Submits credentials
  Auth-&gt;&gt;Auth: Validates login &amp; generates JWT

  Note over U, P: Step 4-5: Permission Check &amp; Popup
  Auth-&gt;&gt;Auth: Confirms app.domain.com in permitted list
  Auth-&gt;&gt;U: Returns page with JWT &amp; opens popup to app.domain.com

  Note over U, P: Step 6: JWT Transfer via postMessage
  Auth-&gt;&gt;P: postMessage(JWT)
  P-&gt;&gt;P: JWT received, initializes local session

  Note over U, P: Step 7-8: Success Confirmation &amp; Redirect
  P-&gt;&gt;Auth: postMessage(&#34;success&#34;)
  Auth-&gt;&gt;U: Closes popup &amp; redirects to app.domain.com
  U-&gt;&gt;A: Accesses protected page with valid local session
</pre>
<p>A key point to remember is that browsers only allow a popup to be opened directly in response to a user action, such as clicking a button. Therefore, you must open the child window at the moment the user submits the login form. A simple <code>&quot;Authenticating...&quot;</code> message is then shown. If authentication fails, the popup closes and an error is displayed. If it succeeds, the flow continues as described.</p>
<p>This method provides a clean, user-friendly single-sign-on experience across multiple customer domains, simplifying a traditionally complex part of SaaS architecture.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/authentication/" alt="Authentication">
          Authentication
        </a>
      
        <a href="/tags/saas/" alt="SaaS">
          SaaS
        </a>
      
        <a href="/tags/cors/" alt="CORS">
          CORS
        </a>
      
      </div>
    
  </footer>
</article>


    </main>

    
      <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
          startOnLoad: true,
        });
      </script>
    <footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2025 —
  <a href="https://www.kevfoster.co.uk/">Kevin Foster</a> 
  <span class="font-normal">with</span>
  <a
    href="https://github.com/nixentric/Lowkey-Hugo-Theme"
    target="_blank"
    rel="noopener noreferrer"
  >
    Lowkey
  </a>
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://github.com/kevin-foster-uk" target="_blank" rel="me noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
